스칼라 서브쿼리는 **select 절에 사브쿼리를 사용하여 하나의 컬럼처럼 사용하기 위한 목적**

-> 성능이.....ㅎ....

이렇게 안되기위해 공부해야함..



http://ojc.asia/bbs/board.php?bo_table=LecSQLnPlSql&wr_id=385

**해시조인(HASH JOIN, USE_HASH, NO_USE_HASH)**

- 해시 조인(Hash-Join)은 두 테이블 중 하나를 기준으로 비트맵 해시 테이블을 메모리에 올린 후 나머지 테이블을 스캔 하면서 해싱 테이블을 적용하여 메모리에 로딩된 테이블과 비교하여 매칭되는 데이터를 추출하는 방식의 조인이다.

- 관계형 데이터베이스에서 가장 비용이 많이 들어가는 조인방법으로 주로 작은 테이블과 큰 테이블의 조인 시 사용되며 , 드라이빙 조건과 상관없이 좋은 성능을 발휘할 수 있는 조인 방법이며 대체로 제일 빠르다.

1. 드라이빙 테이블인, 작은 테이블(Build Input)을 읽어 Hash Area에 해시 테이블 생성하고 해시 함수에서 리턴 받은 해시버킷 주소로 찾아가서 해시 체인에 엔트리를 연결한다.

2. 비드라이빙 테이블, 큰테이블(Probe Input)을 읽어서 해시 테이블을 탐색하면서 조인하는 방식으로, Hash Function에서 에서 리턴 받은 해시 버킷 주소로 찾아가 체인을 스캔하면서 데이터를 찾는 것이다.

- 해시 조인은 안티 조인과 병렬처리와 잘 맞으며 범위 검색(Range scan)이 아닌 동등 비교(Equi-Join, where절에서 등호로 비교하는 경우)에 더 적합하다. 한쪽 테이블이 Hash Area에 담길 정도로 충분히 작아야 하고 Build Input 해시 키 컬럼에 중복 값이 거의 없어야 좋은 성능을 낸다.

- 해시테이블을 만드는 단계는 전체범위처리 불가피, Probe Input을 스캔하는 단계는 NL조인처럼 부분 범위 처리가능 하다.

- 해시 테이블을 생성하는 비용이 수반됨으로 Build Input이 작을때 효과적이며 PGA(or SGA) 메모리에 할당되는 Hash Area에 담길 정도로 충분히 작아야 한다. 해시 키 값으로 사용되는 컬럼에 중복값이 거의 없을 때 효과적이다.

- 해시조인을 사용하기 위해서는 USE_HASH hint를 사용 한다.

- 소트 머지 조인하기에는 두 테이블이 너무 커 소트 부하가 심할 때 유리하며 수행빈도가 낮고 쿼리 수행 시간이 오래 걸리는 대용량 테이블을 조인 할 때 좋으며 해시테이블은 단 하나의 쿼리를 위해 생성하고 조인이 끝나면 곧바로 소멸하는 자료구조이다.

- USE_HASH : HASH JOIN을 하라는 힌트

- NO_USE_HASH : HASH JON을 하지 말라는 힌트